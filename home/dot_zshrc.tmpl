# vim:fileencoding=utf-8:filetype=sh:foldmethod=marker

alias path='echo -e ${PATH//:/\\n} | nl'

alias cm=chezmoi
alias curl="noglob curlie"
alias curlie="noglob curlie"
alias df="df -h"
alias du="du -h"
alias fd="noglob fd"
alias gg="ghq clone"
alias mkdir="mkdir -p"
alias tailf='tail -f'
alias vim=nvim
alias yz="yazi"

if command -v bat >/dev/null 2>&1; then
  alias cat='bat --style "header,plain"'
  export FZF_CTRL_T_OPTS="--preview 'bat -n --color=always {}'"
fi

if command -v lazygit >/dev/null 2>&1; then
  alias lg='lazygit'
fi

# eza is a better ls
if command -v eza >/dev/null 2>&1; then
  ezargs="--ignore-glob='$(awk '{$1=$1} NF{printf "%s|", $0}' "${HOME}/.config/eza/ignore" | sed 's/|$//')' --group-directories-first"

  alias l="eza -a -s type $ezargs"
  alias ls="eza -a -s type $ezargs"
  alias ll="eza -la --git-repos -s type $ezargs"
  alias tree="eza -lT --hyperlink $ezargs"
fi

if command -v starship >/dev/null 2>&1; then
  eval "$(starship init zsh)"
fi

if command -v zoxide >/dev/null 2>&1; then
  eval "$(zoxide init --cmd cd zsh)"
fi

if command -v vivid >/dev/null 2>&1; then
  export LS_COLORS="$(vivid generate molokai)"
fi

function mkd() {
  mkdir -p "$1" && cd "$1" || return
}

function groot() {
  cd "$(git rev-parse --show-toplevel)" || return
}

function gsd() {
  local main=$(git rev-parse --abbrev-ref origin/HEAD | sed 's#origin/##')
  git switch "${main}"
}

function scroll-and-clear-screen() {
  printf '\n%.0s' {1..$LINES}
  zle clear-screen
}
zle -N scroll-and-clear-screen
bindkey '^l' scroll-and-clear-screen

#
# ZSH plugins
#
ANTIDOTE_HOME="${ZDOTDIR:-$HOME}/.antidote"
ANTIDOTE_REPO="https://github.com/mattmc3/antidote"
[[ ! -d "${ANTIDOTE_HOME}" ]] && git clone --depth=1 "${ANTIDOTE_REPO}" "${ANTIDOTE_HOME}"
source "${ANTIDOTE_HOME}/antidote.zsh"
antidote load

if [[ ! -z "$key_info" ]]; then
  bindkey -M "emacs" "$key_info[Up]" history-substring-search-up
  bindkey -M "emacs" "$key_info[Down]" history-substring-search-down
fi

autoload -z edit-command-line
zle -N edit-command-line
bindkey "^X^E" edit-command-line

if command -v fzf >/dev/null 2>&1; then
  source <(fzf --zsh)
  export FZF_ALT_C_COMMAND="ghq list --full-path"
  export FZF_ALT_C_OPTS="--cycle"
fi

if [[ -f "${HOMEBREW_PREFIX}/bin/mise" ]]; then
  eval "$(${HOMEBREW_PREFIX}/bin/mise activate zsh)"
  if [[ -f "${HOMEBREW_PREFIX}/bin/direnv" ]]; then
    eval "$(direnv hook zsh)"
  fi
fi

function _git_log_preview() {
  echo
  git --no-pager log --oneline -n 10
  echo
  zle reset-prompt
}
zle -N _git_log_preview
bindkey "^[g" _git_log_preview

function _dirs() {
  echo
  dirs -v
  echo
  zle reset-prompt
}
zle -N _dirs
bindkey "^[d" _dirs

alias bathelp='bat --plain --language=help'
function h() {
  "$@" --help 2>&1 | bathelp
}

# Copy file content to clipboard
function copy() {
  if [[ -n "${1}" ]]; then
    pbcopy <"${1}"
  fi
}

zstyle -d ':completion:*' special-dirs

[[ -s "${HOME}/.config/zsh/python-venv.sh" ]] && source "${HOME}/.config/zsh/python-venv.sh"

{{- if .work }}
[[ -s "${HOME}/.config/zsh/work-aliases.sh" ]] && source "${HOME}/.config/zsh/work-aliases.sh"
if command -v atuin >/dev/null 2>&1; then
  eval "$(atuin init zsh --disable-up-arrow)"
fi
{{- end }}

# Nix daemon profile
[[ -d /nix/var/nix/profiles ]] && . /nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh
